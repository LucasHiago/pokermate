<?php
use umeworld\lib\Url;
$this->setTitle('结账台');
?>
<div class="c-body-wrap">
	<div class="c-b-list">
		<div class="c-b-list-wrap">
			<div class="c-b-list-item">
				<div class="c-b-l-i-title">2017-02-03</div>
				<div class="c-b-l-i-bottom">
					<a class="l-text"><span>核对数字</span><span>99</span></a>
					<a class="l-edit"></a>
					<a class="l-status"></a>
				</div>
			</div>
			<div class="c-b-list-item new">
				<div class="c-b-l-i-title">2017-02-03</div>
				<div class="c-b-l-i-bottom">
					<a class="l-text"><span>核对数字</span><span>99</span></a>
					<a class="l-edit"></a>
					<a class="l-status l-clean"></a>
				</div>
			</div>
			<div class="c-b-list-item">
				<div class="c-b-l-i-title">2017-02-03</div>
				<div class="c-b-l-i-bottom">
					<a class="l-text"><span>核对数字</span><span>99</span></a>
					<a class="l-edit"></a>
					<a class="l-status"></a>
				</div>
			</div>
			<div class="c-b-list-item new">
				<div class="c-b-l-i-title">2017-02-03</div>
				<div class="c-b-l-i-bottom">
					<a class="l-text"><span>核对数字</span><span>99</span></a>
					<a class="l-edit"></a>
					<a class="l-status l-clean"></a>
				</div>
			</div>
			<div class="c-b-list-item">
				<div class="c-b-l-i-title">2017-02-03</div>
				<div class="c-b-l-i-bottom">
					<a class="l-text"><span>核对数字</span><span>99</span></a>
					<a class="l-edit"></a>
					<a class="l-status"></a>
				</div>
			</div>
			<div class="c-b-list-item new">
				<div class="c-b-l-i-title">2017-02-03</div>
				<div class="c-b-l-i-bottom">
					<a class="l-text"><span>核对数字</span><span>99</span></a>
					<a class="l-edit"></a>
					<a class="l-status l-clean"></a>
				</div>
			</div>
		</div>
		<div class="c-b-list-arrow" onclick="AlertWin.showBillList();"></div>
	</div>
	<div class="c-b-content">
		<div class="c-b-c-left">
			<div class="c-b-c-left-wrap">
				<div class="c-b-c-l-tab">
					<a href="javascript:;" class="cbcl-tab-btn b1"></a>
					<a href="javascript:;" class="cbcl-tab-btn b2"></a>
					<a href="javascript:;" class="cbcl-tab-btn b3"></a>
					<a href="javascript:;" class="cbcl-tab-btn b4"></a>
					<a href="javascript:;" class="cbcl-tab-btn b5"></a>
				</div>
				<div class="c-b-c-l-tab-list">
					<div class="c-b-c-l-tab-list-item">
						<div class="c-b-c-l-tab-list-item-left">
							<div class="i-text">liuliu</div>
							<div class="i-text">74</div>
							<div class="i-text">1400</div>
							<div class="i-text">1370</div>
							<div class="i-text">13570</div>
						</div>
						<div class="c-b-c-l-tab-list-item-right"></div>
					</div>
					<div class="c-b-c-l-tab-list-item">
						<div class="c-b-c-l-tab-list-item-left">
							<div class="i-text">liuliu</div>
							<div class="i-text">74</div>
							<div class="i-text">1400</div>
							<div class="i-text">1370</div>
							<div class="i-text">13570</div>
						</div>
						<div class="c-b-c-l-tab-list-item-right clean"></div>
					</div>
					<div class="c-b-c-l-tab-list-item">
						<div class="c-b-c-l-tab-list-item-left">
							<div class="i-text">liuliu</div>
							<div class="i-text">74</div>
							<div class="i-text">1400</div>
							<div class="i-text">1370</div>
							<div class="i-text">13570</div>
						</div>
						<div class="c-b-c-l-tab-list-item-right"></div>
					</div>
					<div class="c-b-c-l-tab-list-item">
						<div class="c-b-c-l-tab-list-item-left">
							<div class="i-text">liuliu</div>
							<div class="i-text">74</div>
							<div class="i-text">1400</div>
							<div class="i-text">1370</div>
							<div class="i-text">13570</div>
						</div>
						<div class="c-b-c-l-tab-list-item-right clean"></div>
					</div>
					<div class="c-b-c-l-tab-list-item">
						<div class="c-b-c-l-tab-list-item-left">
							<div class="i-text">liuliu</div>
							<div class="i-text">74</div>
							<div class="i-text">1400</div>
							<div class="i-text">1370</div>
							<div class="i-text">13570</div>
						</div>
						<div class="c-b-c-l-tab-list-item-right"></div>
					</div>
					<div class="c-b-c-l-tab-list-item">
						<div class="c-b-c-l-tab-list-item-left">
							<div class="i-text">liuliu</div>
							<div class="i-text">74</div>
							<div class="i-text">1400</div>
							<div class="i-text">1370</div>
							<div class="i-text">13570</div>
						</div>
						<div class="c-b-c-l-tab-list-item-right clean"></div>
					</div>
					<div class="c-b-c-l-tab-list-item">
						<div class="c-b-c-l-tab-list-item-left">
							<div class="i-text">liuliu</div>
							<div class="i-text">74</div>
							<div class="i-text">1400</div>
							<div class="i-text">1370</div>
							<div class="i-text">13570</div>
						</div>
						<div class="c-b-c-l-tab-list-item-right"></div>
					</div>
					<div class="c-b-c-l-tab-list-item">
						<div class="c-b-c-l-tab-list-item-left">
							<div class="i-text">liuliu</div>
							<div class="i-text">74</div>
							<div class="i-text">1400</div>
							<div class="i-text">1370</div>
							<div class="i-text">13570</div>
						</div>
						<div class="c-b-c-l-tab-list-item-right clean"></div>
					</div>
					<div class="c-b-c-l-tab-list-item">
						<div class="c-b-c-l-tab-list-item-left">
							<div class="i-text">liuliu</div>
							<div class="i-text">74</div>
							<div class="i-text">1400</div>
							<div class="i-text">1370</div>
							<div class="i-text">13570</div>
						</div>
						<div class="c-b-c-l-tab-list-item-right"></div>
					</div>
					<div class="c-b-c-l-tab-list-item">
						<div class="c-b-c-l-tab-list-item-left">
							<div class="i-text">liuliu</div>
							<div class="i-text">74</div>
							<div class="i-text">1400</div>
							<div class="i-text">1370</div>
							<div class="i-text">13570</div>
						</div>
						<div class="c-b-c-l-tab-list-item-right clean"></div>
					</div>
					<div class="c-b-c-l-tab-list-item">
						<div class="c-b-c-l-tab-list-item-left">
							<div class="i-text">liuliu</div>
							<div class="i-text">74</div>
							<div class="i-text">1400</div>
							<div class="i-text">1370</div>
							<div class="i-text">13570</div>
						</div>
						<div class="c-b-c-l-tab-list-item-right clean"></div>
					</div>
				</div>
			</div>
		</div>
		<div class="c-b-c-center">
			<a href="javascript:;" class="chaer"></a>
			<a href="javascript:;" class="ball fu">-100</a>
			<a href="javascript:;" class="lmzz"></a>
			<a href="javascript:;" class="krxx"></a>
			<a href="javascript:;" class="lspj"></a>
			<a href="javascript:;" class="jbzc"></a>
			<a href="javascript:;" class="ball">100</a>
		</div>
		<div class="c-b-c-right">
			<div class="c-b-c-r-head">
				<div class="h-zcs">10000</div>
				<div class="h-zbx">10000</div>
				<div class="h-szrs">10000</div>
			</div>
			<div class="c-b-c-r-center">
				<a class="krbh"><input type="text" value="71" /></a>
				<a class="bj"><input type="text" value="1571" /></a>
				<a class="J-jsfs jsfs" data-value="<?php echo $aMoneyTypeList ? $aMoneyTypeList[0]['id'] : 0; ?>"><?php echo $aMoneyTypeList ? $aMoneyTypeList[0]['pay_type'] : ''; ?></a>
				<a class="jsjer"><input type="text" value="0" /></a>
				<a class="sure"></a>
			</div>
			<div class="c-b-c-r-bottom">
				<div class="txt-wrap">
					<a class="momey1">100000</a>
					<a class="momey2">100000</a>
				</div>
				<div class="c-b-c-r-bottom-body">
					<div class="b-b-item-left">
						<div class="h30"></div>
						<div class="b-b-item-left-list">
						<?php foreach($aMoneyTypeList as $aMoneyType){ ?>
							<div class="b-b-i-l-i">
								<div class="type"><?php echo $aMoneyType['pay_type']; ?></div>
								<div class="in-text"><input type="text" value="<?php echo $aMoneyType['money']; ?>" data-id="<?php echo $aMoneyType['id']; ?>" /></div>
								<div class="edit-btn"></div>
							</div>
						<?php } ?>
						</div>
						<div class="op-btn" onclick='AlertWin.showMoneyTypeList(<?php echo json_encode($aMoneyTypeList); ?>);'>新增/删除</div>
					</div>
					<div class="b-b-item-center">
						<div class="h30"></div>
						<div class="b-b-item-center-list">
							<?php foreach($aMoneyOutPutTypeList as $aMoneyOutPutType){ ?>
							<div class="b-b-i-l-i">
								<div class="type"><?php echo $aMoneyOutPutType['out_put_type']; ?></div>
								<div class="in-text"><input type="text" value="<?php echo $aMoneyOutPutType['money']; ?>" data-id="<?php echo $aMoneyOutPutType['id']; ?>" /></div>
								<div class="edit-btn"></div>
							</div>
						<?php } ?>
						</div>
						<div class="op-btn" onclick='AlertWin.showMoneyOutPutTypeList(<?php echo json_encode($aMoneyOutPutTypeList); ?>);'>新增/删除</div>
					</div>
					<div class="b-b-item-right">
						<div class="h30"></div>
						<div class="b-r-stat-w">
							<div class="stat-txt krzbj">10000</div>
							<div class="stat-txt krqk">20000</div>
							<div class="stat-txt krsy">10000</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>


<script type="text/javascript">	
	function initMoneyOutPutType(){
		$('.b-b-item-center-list').tinyscrollbar({axis : 'y', scrollbarVisable : false, wheelSpeed : 5});
		
		function commitMoneyTypeChange(o){
			ajax({
				url : Tools.url('home', 'money-out-put-type/save'),
				data : {
					id : $(o).attr('data-id'),
					money : $(o).val()
				},
				beforeSend : function(){
					$(o).attr('disabled', 'disabled');
				},
				complete : function(){
					$(o).attr('disabled', false);
				},
				success : function(aResult){
					if(aResult.status == 1){
						UBox.show(aResult.msg, aResult.status, function(){
							location.reload();
						}, 3);
					}else{
						UBox.show(aResult.msg, aResult.status);
					}
				}
			});
		}
		
		function initMoneyTypeListEvent(){
			$('.b-b-item-center-list').find('.edit-btn').on('click', function(){
				var oTxt = $(this).parent().find('input');
				var txt = oTxt.val();
				oTxt.val('');
				oTxt.focus();
				oTxt.val(txt);
			});
			
			$('.b-b-item-center-list').find('input').keyup(function(e){
				if(e.keyCode == 13){
					commitMoneyTypeChange(this);
				}
			});
		}
		initMoneyTypeListEvent();
	}

	function initMoneyType(){
		function initJsfs(){
			$('.J-jsfs').on('click', function(){
				var html = '';
				html += '<div class="J-jsfs-select">';
				<?php foreach($aMoneyTypeList as $aMoneyType){ ?>
					html += '<div class="J-jsfs-select-item" data-value="<?php echo $aMoneyType['id']; ?>"><?php echo $aMoneyType['pay_type']; ?></div>';
				<?php } ?>
				html += '</div>';
				var oHtml = $(html);
				$('#pageWraper').append(oHtml);
				oHtml.css({top: $(this).offset().top + 33, left: $(this).offset().left});
				oHtml.find('.J-jsfs-select-item').on('click', function(){
					$('.J-jsfs').attr('data-value', $(this).attr('data-value'));
					$('.J-jsfs').text($(this).text());
					oHtml.remove();
				});
				$(document).on('click', function(e){
					if(!$(e.target).hasClass('J-jsfs')){
						oHtml.remove();
					}
				});
			});
		}
		
		function initMoneyTypeListScroll(){
			$('.b-b-item-left-list').tinyscrollbar({axis : 'y', scrollbarVisable : false, wheelSpeed : 5});
		}
		
		function commitMoneyTypeChange(o){
			ajax({
				url : Tools.url('home', 'money-type/save'),
				data : {
					id : $(o).attr('data-id'),
					money : $(o).val()
				},
				beforeSend : function(){
					$(o).attr('disabled', 'disabled');
				},
				complete : function(){
					$(o).attr('disabled', false);
				},
				success : function(aResult){
					if(aResult.status == 1){
						UBox.show(aResult.msg, aResult.status, function(){
							location.reload();
						}, 3);
					}else{
						UBox.show(aResult.msg, aResult.status);
					}
				}
			});
		}
		
		function initMoneyTypeListEvent(){
			$('.b-b-item-left-list').find('.edit-btn').on('click', function(){
				var oTxt = $(this).parent().find('input');
				var txt = oTxt.val();
				oTxt.val('');
				oTxt.focus();
				oTxt.val(txt);
			});
			
			$('.b-b-item-left-list').find('input').keyup(function(e){
				if(e.keyCode == 13){
					commitMoneyTypeChange(this);
				}
			});
		}
		
		initJsfs();
		initMoneyTypeListScroll();
		initMoneyTypeListEvent();
	}

	function ajustClubList(){
		$('.c-h-center-w').width(parseInt($('.c-h-item').length) * 160 - 102);
	}
	
	$(function(){
		$('.c-h-t-menu.m1').addClass('active');
		
		ajustClubList();
		
		initMoneyType();
		initMoneyOutPutType();
	});
</script>